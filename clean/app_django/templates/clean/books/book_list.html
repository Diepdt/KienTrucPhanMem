{% load static %}
<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Store (Clean Arch)</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <style>
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 4px;
            color: white;
            z-index: 1000;
            animation: slideIn 0.3s ease-in-out;
        }

        .notification.success {
            background-color: #28a745;
        }

        .notification.error {
            background-color: #dc3545;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }

            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }
    </style>
</head>

<body>
    <div class="navbar">
        <div class="navbar-left">
            {% if request.session.customer_id %}
            <span>üë§ Xin ch√†o, {{ request.session.customer_name }}!</span>
            <a href="{% url 'clean:cart_detail' %}">Gi·ªè h√†ng</a>
            <a href="{% url 'clean:logout' %}">ƒêƒÉng xu·∫•t</a>
            {% else %}
            <a href="{% url 'clean:login' %}">ƒêƒÉng nh·∫≠p</a>
            <a href="{% url 'clean:register' %}">ƒêƒÉng k√Ω</a>
            {% endif %}
        </div>
    </div>

    <div class="container">
        <h1>Danh m·ª•c s√°ch (Clean Architecture)</h1>
        <div class="book-grid">
            {% for book in books %}
            <div class="book-card">
                <h3>{{ book.title }}</h3>
                <p><strong>T√°c gi·∫£:</strong> {{ book.author }}</p>
                <p class="price">{{ book.price|floatformat:0 }} VNƒê</p>
                <p class="stock {% if book.stock < 5 %}low{% endif %}">
                    C√≤n l·∫°i: <strong>{{ book.stock }}</strong> cu·ªën
                </p>

                {% if request.session.customer_id %}
                <button onclick="addToCart({{ book.id }}, '{{ book.title }}')" class="btn btn-primary">
                    Th√™m v√†o gi·ªè
                </button>
                {% else %}
                <p class="login-required">
                    Vui l√≤ng <a href="{% url 'clean:login' %}">ƒëƒÉng nh·∫≠p</a> ƒë·ªÉ mua h√†ng
                </p>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>

    <script>
        function addToCart(bookId, bookTitle) {
            const url = `/clean/cart/add/${bookId}/`;
            fetch(url, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showNotification(`‚úì ƒê√£ th√™m "${bookTitle}" v√†o gi·ªè h√†ng`, 'success');
                    } else {
                        showNotification(`‚úó ${data.error}`, 'error');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    showNotification('C√≥ l·ªói x·∫£y ra, vui l√≤ng th·ª≠ l·∫°i', 'error');
                });
        }

        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease-in-out';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
    </script>
</body>

</html>
</body>

</html>